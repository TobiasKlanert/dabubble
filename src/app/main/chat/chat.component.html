<div class="chat-container flex-column">
  <div class="header-container flex-row flex-sb flex-center">
    <ng-container *ngIf="currentChatType === chatType.Channel">
      <div class="headline-container">
        <button class="btn-channel-info" (click)="openOverlay('channelInfo')">
          <svg
            width="32"
            height="33"
            viewBox="0 0 32 33"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M9.65649 28C9.23359 28 8.88859 27.8203 8.6215 27.4609C8.3544 27.1016 8.2765 26.7062 8.38779 26.275L9.32262 22.25H6.35119C5.90603 22.25 5.5499 22.0646 5.28281 21.6937C5.01571 21.3219 4.93781 20.9083 5.0491 20.4531C5.11587 20.1177 5.27168 19.8542 5.51652 19.6625C5.76135 19.4708 6.03958 19.375 6.35119 19.375H9.99036L11.3258 13.625H7.68666C7.2415 13.625 6.88538 13.4396 6.61828 13.0687C6.35119 12.6969 6.27328 12.2833 6.38457 11.8281C6.45135 11.4927 6.60715 11.2292 6.85199 11.0375C7.09683 10.8458 7.37505 10.75 7.68666 10.75H11.9936L13.0953 6.04219C13.1621 5.73073 13.3068 5.47917 13.5294 5.2875C13.7519 5.09583 14.019 5 14.3307 5C14.7536 5 15.0986 5.17969 15.3656 5.53906C15.6327 5.89844 15.7106 6.29375 15.5994 6.725L14.6645 10.75H20.0064L21.1082 6.04219C21.175 5.73073 21.3196 5.47917 21.5422 5.2875C21.7648 5.09583 22.0319 5 22.3435 5C22.7664 5 23.1114 5.17969 23.3785 5.53906C23.6456 5.89844 23.7235 6.29375 23.6122 6.725L22.6774 10.75H25.6488C26.094 10.75 26.4501 10.9354 26.7172 11.3063C26.9843 11.6781 27.0622 12.0917 26.9509 12.5469C26.8841 12.8823 26.7283 13.1458 26.4835 13.3375C26.2386 13.5292 25.9604 13.625 25.6488 13.625H22.0096L20.6742 19.375H24.3133C24.7585 19.375 25.1146 19.5604 25.3817 19.9313C25.6488 20.3031 25.7267 20.7167 25.6154 21.1719C25.5487 21.5073 25.3928 21.7708 25.148 21.9625C24.9032 22.1542 24.6249 22.25 24.3133 22.25H20.0064L18.9047 26.9578C18.8379 27.2693 18.6932 27.5208 18.4706 27.7125C18.2481 27.9042 17.981 28 17.6693 28C17.2464 28 16.9014 27.8203 16.6344 27.4609C16.3673 27.1016 16.2894 26.7062 16.4006 26.275L17.3355 22.25H11.9936L10.8918 26.9578C10.825 27.2693 10.6804 27.5208 10.4578 27.7125C10.2352 27.9042 9.9681 28 9.65649 28ZM12.6613 19.375H18.0032L19.3387 13.625H13.9968L12.6613 19.375Z"
              fill="black"
            />
          </svg>
          <h2 class="headline">{{ currentChat?.name }}</h2>
          <svg
            width="30"
            height="31"
            viewBox="0 0 30 31"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M15 19.5938C14.8326 19.5938 14.6706 19.5625 14.5141 19.5C14.3567 19.4375 14.2257 19.3542 14.1211 19.25L8.34529 13.5C8.1151 13.2708 8 12.9792 8 12.625C8 12.2708 8.1151 11.9792 8.34529 11.75C8.57549 11.5208 8.86846 11.4062 9.22422 11.4062C9.57997 11.4062 9.87294 11.5208 10.1031 11.75L15 16.625L19.8969 11.75C20.1271 11.5208 20.42 11.4062 20.7758 11.4062C21.1315 11.4062 21.4245 11.5208 21.6547 11.75C21.8849 11.9792 22 12.2708 22 12.625C22 12.9792 21.8849 13.2708 21.6547 13.5L15.8789 19.25C15.7534 19.375 15.6173 19.4633 15.4709 19.515C15.3244 19.5675 15.1674 19.5938 15 19.5938Z"
              fill="black"
            />
          </svg>
        </button>
      </div>
      <div class="user-wrapper">
        <div class="user-container" (click)="openOverlay('channelMembers')">
          <div class="user-icon-container">
            @for (member of channelMembers; let i = $index; track member.id) {
            <img
              class="user"
              src="{{ member.profilePictureUrl }}"
              alt="Profilbild"
              [ngStyle]="{
                'margin-left': i === 0 ? '0px' : '-10px',
                left: '-' + i * 5 + 'px',
                'z-index': i + 1,
                position: 'relative'
              }"
            />
            }
          </div>
          <p class="counter">{{ members }}</p>
        </div>
        <button class="btn-add-user" (click)="openOverlay('addUser')">
          <svg
            class="add-user"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <mask
              id="mask0_143619_13329"
              style="mask-type: alpha"
              maskUnits="userSpaceOnUse"
              x="0"
              y="0"
              width="24"
              height="24"
            >
              <rect width="24" height="24" fill="#D9D9D9" />
            </mask>
            <g mask="url(#mask0_143619_13329)">
              <path
                d="M19 14C18.7167 14 18.4793 13.904 18.288 13.712C18.096 13.5207 18 13.2833 18 13V11H16C15.7167 11 15.4793 10.904 15.288 10.712C15.096 10.5207 15 10.2833 15 10C15 9.71667 15.096 9.479 15.288 9.287C15.4793 9.09567 15.7167 9 16 9H18V7C18 6.71667 18.096 6.479 18.288 6.287C18.4793 6.09567 18.7167 6 19 6C19.2833 6 19.5207 6.09567 19.712 6.287C19.904 6.479 20 6.71667 20 7V9H22C22.2833 9 22.5207 9.09567 22.712 9.287C22.904 9.479 23 9.71667 23 10C23 10.2833 22.904 10.5207 22.712 10.712C22.5207 10.904 22.2833 11 22 11H20V13C20 13.2833 19.904 13.5207 19.712 13.712C19.5207 13.904 19.2833 14 19 14ZM9 12C7.9 12 6.95833 11.6083 6.175 10.825C5.39167 10.0417 5 9.1 5 8C5 6.9 5.39167 5.95833 6.175 5.175C6.95833 4.39167 7.9 4 9 4C10.1 4 11.0417 4.39167 11.825 5.175C12.6083 5.95833 13 6.9 13 8C13 9.1 12.6083 10.0417 11.825 10.825C11.0417 11.6083 10.1 12 9 12ZM2 20C1.71667 20 1.47933 19.904 1.288 19.712C1.096 19.5207 1 19.2833 1 19V17.2C1 16.6333 1.146 16.1123 1.438 15.637C1.72933 15.1623 2.11667 14.8 2.6 14.55C3.63333 14.0333 4.68333 13.6457 5.75 13.387C6.81667 13.129 7.9 13 9 13C10.1 13 11.1833 13.129 12.25 13.387C13.3167 13.6457 14.3667 14.0333 15.4 14.55C15.8833 14.8 16.2707 15.1623 16.562 15.637C16.854 16.1123 17 16.6333 17 17.2V19C17 19.2833 16.904 19.5207 16.712 19.712C16.5207 19.904 16.2833 20 16 20H2ZM3 18H15V17.2C15 17.0167 14.9543 16.85 14.863 16.7C14.771 16.55 14.65 16.4333 14.5 16.35C13.6 15.9 12.6917 15.5623 11.775 15.337C10.8583 15.1123 9.93333 15 9 15C8.06667 15 7.14167 15.1123 6.225 15.337C5.30833 15.5623 4.4 15.9 3.5 16.35C3.35 16.4333 3.22933 16.55 3.138 16.7C3.046 16.85 3 17.0167 3 17.2V18ZM9 10C9.55 10 10.021 9.804 10.413 9.412C10.8043 9.02067 11 8.55 11 8C11 7.45 10.8043 6.97933 10.413 6.588C10.021 6.196 9.55 6 9 6C8.45 6 7.97933 6.196 7.588 6.588C7.196 6.97933 7 7.45 7 8C7 8.55 7.196 9.02067 7.588 9.412C7.97933 9.804 8.45 10 9 10Z"
                fill="black"
              />
            </g>
          </svg>
        </button>
      </div>
    </ng-container>
    <ng-container
      *ngIf="currentChatType === chatType.DirectMessage && currentChat"
    >
      <button
        class="profile-button"
        (click)="openProfile(currentChatPartner.id)"
      >
        <div class="profile-picture-container">
          <img
            class="profile-picture"
            src="{{ currentChatPartner.profilePictureUrl }}"
            alt="Profilbild von {{ currentChatPartner.name }}"
          />
          <span
            class="online-marker"
            [ngStyle]="{
              'background-color': currentChatPartner.onlineStatus
                ? '#92C83E'
                : '#686868'
            }"
          ></span>
        </div>
        <p>{{ currentChatPartner.name }}</p>
      </button>
    </ng-container>
    <ng-container *ngIf="currentChatType === chatType.NewChat">
      <div class="search-container">
        <h2 class="headline">Neue Nachricht</h2>
        <input
          #searchInput
          name="searchInput"
          type="text"
          class="form-input"
          placeholder="An: #channel, oder @jemand oder E-Mail Adresse"
          (input)="onSearch(searchInput.value, searchType.NewChat)"
        />
        @if (searchResults.length > 0 && currentSearchType ===
        searchType.NewChat) {
        <app-search-menu
          class="search-menu"
          (clickOutside)="searchResults = []"
          [searchResults]="searchResults"
          [searchType]="searchType.NewChat"
        >
        </app-search-menu>
        }
      </div>
    </ng-container>
  </div>
  <div #scrollContainer class="message-container">
    <app-single-message
      class="single-message"
      *ngFor="let msg of chatMessages; let i = index; let last = last"
      [ngStyle]="{
      'padding-top': i === 0 ? '16px' : '0px',
      }"
      [message]="msg"
      [chatId]="currentChatId"
      [showButtons]="true"
    ></app-single-message>
  </div>
  <div
    class="new-chat-container"
    *ngIf="
      chatMessages.length === 0 &&
      currentChatType === chatType.Channel &&
      areMessagesLoaded
    "
  >
    <div class="new-chat-headline">
      <svg
        width="32"
        height="33"
        viewBox="0 0 32 33"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          d="M9.65649 28C9.23359 28 8.88859 27.8203 8.6215 27.4609C8.3544 27.1016 8.2765 26.7062 8.38779 26.275L9.32262 22.25H6.35119C5.90603 22.25 5.5499 22.0646 5.28281 21.6937C5.01571 21.3219 4.93781 20.9083 5.0491 20.4531C5.11587 20.1177 5.27168 19.8542 5.51652 19.6625C5.76135 19.4708 6.03958 19.375 6.35119 19.375H9.99036L11.3258 13.625H7.68666C7.2415 13.625 6.88538 13.4396 6.61828 13.0687C6.35119 12.6969 6.27328 12.2833 6.38457 11.8281C6.45135 11.4927 6.60715 11.2292 6.85199 11.0375C7.09683 10.8458 7.37505 10.75 7.68666 10.75H11.9936L13.0953 6.04219C13.1621 5.73073 13.3068 5.47917 13.5294 5.2875C13.7519 5.09583 14.019 5 14.3307 5C14.7536 5 15.0986 5.17969 15.3656 5.53906C15.6327 5.89844 15.7106 6.29375 15.5994 6.725L14.6645 10.75H20.0064L21.1082 6.04219C21.175 5.73073 21.3196 5.47917 21.5422 5.2875C21.7648 5.09583 22.0319 5 22.3435 5C22.7664 5 23.1114 5.17969 23.3785 5.53906C23.6456 5.89844 23.7235 6.29375 23.6122 6.725L22.6774 10.75H25.6488C26.094 10.75 26.4501 10.9354 26.7172 11.3063C26.9843 11.6781 27.0622 12.0917 26.9509 12.5469C26.8841 12.8823 26.7283 13.1458 26.4835 13.3375C26.2386 13.5292 25.9604 13.625 25.6488 13.625H22.0096L20.6742 19.375H24.3133C24.7585 19.375 25.1146 19.5604 25.3817 19.9313C25.6488 20.3031 25.7267 20.7167 25.6154 21.1719C25.5487 21.5073 25.3928 21.7708 25.148 21.9625C24.9032 22.1542 24.6249 22.25 24.3133 22.25H20.0064L18.9047 26.9578C18.8379 27.2693 18.6932 27.5208 18.4706 27.7125C18.2481 27.9042 17.981 28 17.6693 28C17.2464 28 16.9014 27.8203 16.6344 27.4609C16.3673 27.1016 16.2894 26.7062 16.4006 26.275L17.3355 22.25H11.9936L10.8918 26.9578C10.825 27.2693 10.6804 27.5208 10.4578 27.7125C10.2352 27.9042 9.9681 28 9.65649 28ZM12.6613 19.375H18.0032L19.3387 13.625H13.9968L12.6613 19.375Z"
          fill="black"
        />
      </svg>
      <p class="headline">{{ chatName }}</p>
    </div>
    <div class="welcome-msg">
      <p>
        Du hast diesen Channel heute erstellt. Das ist der Anfang des Channels
      </p>
      <button (click)="openOverlay('channelInfo')">
        {{ chatToken }}
      </button>
    </div>
  </div>
  <div
    class="new-chat-container"
    *ngIf="
      chatMessages.length === 0 &&
      currentChatType === chatType.DirectMessage &&
      areMessagesLoaded
    "
  >
    <div class="new-chat-headline">
      <img
        class="new-chat-avatar"
        src="{{ currentChatPartner.profilePictureUrl }}"
        alt="Profilbild von {{ currentChatPartner.name }}"
      />
      <p class="headline">{{ chatName }}</p>
    </div>
    <div class="welcome-msg">
      <p class="text-grey">Diese Unterhaltung findet nur zwischen</p>
      <button (click)="openProfile(currentChatPartner.id)">
        {{ chatToken }}
      </button>
      <p class="text-grey">und dir statt.</p>
    </div>
  </div>
  <!--
    TODO: Implement a welcome message for own chat
  -->
  <div class="textarea-container">
    <app-emoji-menu
      [onTextEmojiSelected]="addTextEmoji"
      *ngIf="emojiService._showPickerInChannels"
      hover-outside
      (hoverOutside)="emojiService.closePickerInChannels()"
    ></app-emoji-menu>
    <div class="button-wrapper flex-row flex-sb">
      <div class="flex-row">
        <svg
          (click)="toggleEmojiPicker()"
          class="textarea-icon"
          width="40"
          height="40"
          viewBox="0 0 40 40"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <mask
            id="mask0_143922_16674"
            style="mask-type: alpha"
            maskUnits="userSpaceOnUse"
            x="8"
            y="8"
            width="24"
            height="24"
          >
            <rect x="8" y="8" width="24" height="24" fill="#D9D9D9" />
          </mask>
          <g mask="url(#mask0_143922_16674)">
            <path
              d="M23.5 19C23.9333 19 24.2917 18.8583 24.575 18.575C24.8583 18.2917 25 17.9333 25 17.5C25 17.0667 24.8583 16.7083 24.575 16.425C24.2917 16.1417 23.9333 16 23.5 16C23.0667 16 22.7083 16.1417 22.425 16.425C22.1417 16.7083 22 17.0667 22 17.5C22 17.9333 22.1417 18.2917 22.425 18.575C22.7083 18.8583 23.0667 19 23.5 19ZM16.5 19C16.9333 19 17.2917 18.8583 17.575 18.575C17.8583 18.2917 18 17.9333 18 17.5C18 17.0667 17.8583 16.7083 17.575 16.425C17.2917 16.1417 16.9333 16 16.5 16C16.0667 16 15.7083 16.1417 15.425 16.425C15.1417 16.7083 15 17.0667 15 17.5C15 17.9333 15.1417 18.2917 15.425 18.575C15.7083 18.8583 16.0667 19 16.5 19ZM20 25.5C20.95 25.5 21.8167 25.2877 22.6 24.863C23.3833 24.4377 23.9917 23.9 24.425 23.25C24.625 22.95 24.6543 22.6667 24.513 22.4C24.371 22.1333 24.15 22 23.85 22C23.7333 22 23.6167 22.0333 23.5 22.1C23.3833 22.1667 23.2917 22.25 23.225 22.35C22.8583 22.85 22.4 23.25 21.85 23.55C21.3 23.85 20.6833 24 20 24C19.3167 24 18.7 23.85 18.15 23.55C17.6 23.25 17.1417 22.85 16.775 22.35C16.7083 22.25 16.6127 22.1667 16.488 22.1C16.3627 22.0333 16.2417 22 16.125 22C15.8417 22 15.6293 22.129 15.488 22.387C15.346 22.6457 15.3667 22.9167 15.55 23.2C16 23.8833 16.6167 24.4377 17.4 24.863C18.1833 25.2877 19.05 25.5 20 25.5ZM20 30C18.6167 30 17.3167 29.7373 16.1 29.212C14.8833 28.6873 13.825 27.975 12.925 27.075C12.025 26.175 11.3127 25.1167 10.788 23.9C10.2627 22.6833 10 21.3833 10 20C10 18.6167 10.2627 17.3167 10.788 16.1C11.3127 14.8833 12.025 13.825 12.925 12.925C13.825 12.025 14.8833 11.3123 16.1 10.787C17.3167 10.2623 18.6167 10 20 10C21.3833 10 22.6833 10.2623 23.9 10.787C25.1167 11.3123 26.175 12.025 27.075 12.925C27.975 13.825 28.6873 14.8833 29.212 16.1C29.7373 17.3167 30 18.6167 30 20C30 21.3833 29.7373 22.6833 29.212 23.9C28.6873 25.1167 27.975 26.175 27.075 27.075C26.175 27.975 25.1167 28.6873 23.9 29.212C22.6833 29.7373 21.3833 30 20 30ZM20 28C22.2167 28 24.1043 27.221 25.663 25.663C27.221 24.1043 28 22.2167 28 20C28 17.7833 27.221 15.8957 25.663 14.337C24.1043 12.779 22.2167 12 20 12C17.7833 12 15.896 12.779 14.338 14.337C12.7793 15.8957 12 17.7833 12 20C12 22.2167 12.7793 24.1043 14.338 25.663C15.896 27.221 17.7833 28 20 28Z"
              fill="currentColor"
            />
          </g>
        </svg>
        <svg
          class="textarea-icon"
          width="40"
          height="40"
          viewBox="0 0 40 40"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <mask
            id="mask0_143922_16678"
            style="mask-type: alpha"
            maskUnits="userSpaceOnUse"
            x="8"
            y="8"
            width="24"
            height="24"
          >
            <rect x="8" y="8" width="24" height="24" fill="#D9D9D9" />
          </mask>
          <g mask="url(#mask0_143922_16678)">
            <path
              d="M20 30C18.6333 30 17.3417 29.7373 16.125 29.212C14.9083 28.6873 13.846 27.9707 12.938 27.062C12.0293 26.154 11.3127 25.0917 10.788 23.875C10.2627 22.6583 10 21.3667 10 20C10 18.6167 10.2627 17.321 10.788 16.113C11.3127 14.9043 12.0293 13.846 12.938 12.938C13.846 12.0293 14.9083 11.3123 16.125 10.787C17.3417 10.2623 18.6333 10 20 10C21.3833 10 22.679 10.2623 23.887 10.787C25.0957 11.3123 26.154 12.0293 27.062 12.938C27.9707 13.846 28.6873 14.9043 29.212 16.113C29.7373 17.321 30 18.6167 30 20V21.45C30 22.4333 29.6627 23.2707 28.988 23.962C28.3127 24.654 27.4833 25 26.5 25C25.9 25 25.3417 24.8667 24.825 24.6C24.3083 24.3333 23.8833 23.9833 23.55 23.55C23.1 24 22.571 24.3543 21.963 24.613C21.3543 24.871 20.7 25 20 25C18.6167 25 17.4377 24.5123 16.463 23.537C15.4877 22.5623 15 21.3833 15 20C15 18.6167 15.4877 17.4373 16.463 16.462C17.4377 15.4873 18.6167 15 20 15C21.3833 15 22.5627 15.4873 23.538 16.462C24.5127 17.4373 25 18.6167 25 20V21.45C25 21.9333 25.15 22.3123 25.45 22.587C25.75 22.8623 26.1 23 26.5 23C26.9 23 27.25 22.8623 27.55 22.587C27.85 22.3123 28 21.9333 28 21.45V20C28 17.8167 27.2123 15.9373 25.637 14.362C24.0623 12.7873 22.1833 12 20 12C17.8167 12 15.9373 12.7873 14.362 14.362C12.7873 15.9373 12 17.8167 12 20C12 22.1833 12.7873 24.0623 14.362 25.637C15.9373 27.2123 17.8167 28 20 28H24C24.2833 28 24.5207 28.096 24.712 28.288C24.904 28.4793 25 28.7167 25 29C25 29.2833 24.904 29.5207 24.712 29.712C24.5207 29.904 24.2833 30 24 30H20ZM20 23C20.8333 23 21.5417 22.7083 22.125 22.125C22.7083 21.5417 23 20.8333 23 20C23 19.1667 22.7083 18.4583 22.125 17.875C21.5417 17.2917 20.8333 17 20 17C19.1667 17 18.4583 17.2917 17.875 17.875C17.2917 18.4583 17 19.1667 17 20C17 20.8333 17.2917 21.5417 17.875 22.125C18.4583 22.7083 19.1667 23 20 23Z"
              fill="currentColor"
            />
          </g>
        </svg>
      </div>
      <div (click)="sendMessage()">
        <svg
          class="send-icon"
          width="40"
          height="40"
          viewBox="0 0 40 40"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <mask
            id="mask0_143922_16682"
            style="mask-type: alpha"
            maskUnits="userSpaceOnUse"
            x="5"
            y="5"
            width="30"
            height="30"
          >
            <rect x="5" y="5" width="30" height="30" fill="#D9D9D9" />
          </mask>
          <g mask="url(#mask0_143922_16682)">
            <path
              d="M10.5 29.2812C10.0833 29.4479 9.6875 29.4112 9.3125 29.1712C8.9375 28.9321 8.75 28.5833 8.75 28.125V23.4687C8.75 23.1771 8.83333 22.9167 9 22.6875C9.16667 22.4583 9.39583 22.3125 9.6875 22.25L18.75 20L9.6875 17.75C9.39583 17.6875 9.16667 17.5417 9 17.3125C8.83333 17.0833 8.75 16.8229 8.75 16.5312V11.875C8.75 11.4167 8.9375 11.0675 9.3125 10.8275C9.6875 10.5883 10.0833 10.5521 10.5 10.7187L29.75 18.8437C30.2708 19.0729 30.5312 19.4583 30.5312 20C30.5312 20.5417 30.2708 20.9271 29.75 21.1562L10.5 29.2812Z"
              fill="currentColor"
            />
          </g>
        </svg>
      </div>
    </div>
    <ng-container>
      <textarea
        #inputMessage
        [(ngModel)]="inputText"
        name="send-message"
        placeholder="Nachricht an {{ chatToken }}"
        (input)="onSearch(inputMessage.value, searchType.MentionUserOrChannel)"
      ></textarea>
      @if (!isSearchMenuHidden && searchResults.length > 0 && currentSearchType
      === searchType.MentionUserOrChannel) {
      <app-search-menu
        class="mention-menu"
        (clickOutside)="searchResults = []"
        (elementSelected)="insertMention($event)"
        [searchResults]="searchResults"
        [searchType]="searchType.MentionUserOrChannel"
      >
      </app-search-menu>
      }
    </ng-container>
  </div>
</div>
